# Changing nftables rules to allow IP forwarding (make and write these changes to nftables.conf)
    sudo nano /etc/nftables.conf
        table inet filter {
            chain forward {
                type filter hook forward priority 0; policy drop;
        
                # Allow established/related
                ct state established,related accept
        
                # Forward between interfaces
                iif "enp0s3" oif "enp0s8" accept
                iif "enp0s8" oif "enp0s3" accept
            }
        }

# Enable IP forwarding in sysctl.conf
    echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
    sudo sysctl -p

# Downloading and starting the LAMP stack (bash)
    sudo apt install apache2 mariadb-server php libapache2-mod-php php-mysql -y
    sudo systemctl enable apache2 mariadb
    sudo systemctl start apache2 mariadb

# Building the database(indented portion in SQL)
    sudo mysql
        CREATE DATABASE vulnsite;
        USE vulnsite;
        CREATE TABLE users (
            id INT AUTO_INCREMENT PRIMARY KEY,
            username VARCHAR(50),
            password VARCHAR(50)
        );
        INSERT INTO users (username, password) VALUES
        ('admin', 'password123'),
        ('user', ‘cool42’),
        ('privuser', 'abcd987');
        CREATE USER 'vulnuser'@'localhost' IDENTIFIED BY 'vulnpassword';      # Creating a user for the PHP file to avoid errors with root
        GRANT ALL PRIVILEGES ON vulnsite.* TO 'vulnuser'@'localhost';
        FLUSH PRIVILEGES;

# Downloading Suricata
    sudo apt update
    sudo apt install suricata -y

# Configuring Suricata (make and write these changes to suricata.yaml)
    sudo nano /etc/suricata/suricata.yaml
        runmode: workers
        $HOME_NET: [10.20.0.0/24]      # The victim subnet
        $EXTERNAL_NET: !$HOME_NET       # Everything that is not the victim subnet
        default-rule-path: /etc/suricata/rules
        rule-files:
          - suricata.rules
        af-packet:
          - interface: eth1
            cluster-id: 99
            cluster-type: cluster_flow
            defrag: yes
          - interface: eth2
            cluster-id: 100
            cluster-type: cluster_flow
            defrag: yes
        outputs:
          - eve-log:
              enabled: yes
              filetype: regular
              filename: /var/log/suricata/eve.json
              types:
                - alert

# To run Suricata in the foreground
    sudo systemctl stop suricata # to eliminate any Suricata processes running in the background
    sudo suricata -c /etc/suricata/suricata.yaml --af-packet

# Downloading EveBox & adding repository
    sudo apt install curl #if not already installed
    curl -fsSL https://evebox.org/files/GPG-KEY-evebox -o /etc/apt/keyrings/evebox.asc
    echo "deb [signed-by=/etc/apt/keyrings/evebox.asc] https://evebox.org/files/debian stable main" | sudo tee /etc/apt/sources.list.d/evebox.list #adding evebox repository
    sudo apt install evebox

# Configuring EveBox (make and write these changes to evebox.yaml)
    sudo nano /etc/evebox/evebox.yaml
        database:
          type: sqlite
          filename: /var/lib/evebox/evebox.sqlite
        input:
          - type: suricata
            path: /var/log/suricata/eve.json
            mode: tail

# Running EveBox as a oneshot(reads eve.json for visualization of alerts)
    evebox oneshot /var/log/suricata/eve.json
